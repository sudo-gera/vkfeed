<!DOCTYPE html>
<html>
<head>
	<title>vkfeed</title>
	<style type="text/css">
		.post{
			border: 16px solid #160057;
			overflow-wrap: anywhere;
			text-align: center;
		}
		body {
			background-color: #13002f;
			color: #FFFFFF;
		}
	</style>
	<script type="text/javascript">

		posts=[]

		function getScrollPercent() {
		var h = document.documentElement, 
			b = document.body,
			st = 'scrollTop',
			sh = 'scrollHeight';
			return (h[st]||b[st]) / ((h[sh]||b[sh]) - h.clientHeight);
		}

		function onscroll(){
			p=getScrollPercent();
			if (p>0.75){
				if (posts.length>0){
					p=posts[posts.length-1]
					load('page_'+p.split('-->')[0])
				}
				else{
					load()
				}
			}
		}

		window.addEventListener('scroll',onscroll)
		window.addEventListener('DOMContentLoaded', onload)
		
		function onload(){
			load('load')
		}

		isnew=0

		function load(url=''){
			fetch('/'+url).then(function(r){
				r.json().then(function(j){
					for (s of j){
						posts.push(s)
					}
					isnew=1
				})
			})
		}

		function show(){
			if (isnew==0){
				return
			}
			isnew=0
			html=''
			posts=posts.filter((post,pos) => {
				return posts.indexOf(post)==pos
			})
			for (post of posts){
				html+=post
			}
			document.getElementById('body').innerHTML=html
		}

		setInterval(show,1000)

	</script>
</head>
<body>
	<div id="body"></div>
</body>
</html>